# 深入了解现代网络浏览器

Chrome 从高级架构到渲染管道的细节。适合了解浏览器如何将您的代码变成功能性网站，以及如何使用特定技术来提高性能。

### 进程与线程

启动应用程序时，会创建一个进程。该程序可能会创建线程来帮助它工作，但这是可选的。操作系统为进程提供了一块可使用的内存“平板”，所有应用程序状态都保存在该私有内存空间中。当您关闭应用程序时，该进程也会消失，并且操作系统会释放内存。

一个进程可以要求操作系统启动另一个进程来运行不同的任务。发生这种情况时，将为新进程分配内存的不同部分。**如果**两个进程需要通信，它们可以通过使用**进程间通信( IPC )**来实现。许多应用程序被设计为以这种方式工作，因此如果一个工作进程没有响应，它可以在不停止运行应用程序不同部分的其他进程的情况下重新启动。

![工作进程和IPC](https://wd.imgix.net/image/T4FyVKpzu4WKF1kBNvXepbi08t52/OdFbLc2ufRmkJoHinTUL.svg)

### 浏览器架构：如何使用进程和线程构建 Web 浏览器

该图展示了进程/线程图中的不同浏览器架构，主要注意的是，不同的架构是实现细节。没有关于如何构建 Web 浏览器的标准规范。一种浏览器的方法可能与另一种完全不同![浏览器架构](https://wd.imgix.net/image/T4FyVKpzu4WKF1kBNvXepbi08t52/BG4tvT7y95iPAelkeadP.png?auto=format)

以下为 Chrome 的最新架构

顶部是浏览器进程与处理应用程序不同部分的其他进程协调。对于渲染器进程，会创建多个进程并将其分配给每个选项卡。直到最近，Chrome 还在可能的情况下为每个选项卡提供了一个进程；现在它尝试为每个站点提供自己的进程，包括 iframe（请参阅[站点隔离](https://developer.chrome.com/blog/inside-browser-part1/#site-isolation)）。

![浏览器架构](https://wd.imgix.net/image/T4FyVKpzu4WKF1kBNvXepbi08t52/JvSL0B5q1DmZAKgRHj42.png?auto=format)

### 不同进程控制什么

下表描述了每个 Chrome 进程及其控制的内容：

| Process and What it controls | Process and What it controls                                 |
| ---------------------------- | ------------------------------------------------------------ |
| Browser                      | Controls "chrome" part of the application including address bar, bookmarks, back and forward buttons. Also handles the invisible, privileged parts of a web browser such as network requests and file access. |
| Renderer                     | Controls anything inside of the tab where a website is displayed. |
| Plugin                       | Controls any plugins used by the website, for example, flash. |
| GPU                          | Handles GPU tasks in isolation from other processes. It is separated into different process because GPUs handles requests from multiple apps and draw them in the same surface. |

![Chrome processes](https://wd.imgix.net/image/T4FyVKpzu4WKF1kBNvXepbi08t52/vl5sRzL8pFwlLSN7WW12.png?auto=format)

将浏览器的工作分成多个进程的另一个好处是**安全性和沙盒**。由于操作系统提供了一种限制进程权限的方法，因此浏览器可以对某些进程的某些功能进行沙箱处理。例如，Chrome 浏览器限制处理任意用户输入的进程（如渲染器进程）的任意文件访问。

因为进程有自己的私有内存空间，它们通常包含通用基础设施的副本（例如 V8，它是 Chrome 的 JavaScript 引擎）。这意味着更多的内存使用，因为它们不能像在同一进程中的线程那样共享。

为了节省内存，Chrome 限制了它可以启动的进程数。限制取决于您的设备拥有多少内存和 CPU 能力，但是当 Chrome 达到限制时，它会开始在一个进程中运行来自同一站点的多个选项卡。

### 节省更多内存 - Chrome 中的服务化